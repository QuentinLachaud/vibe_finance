function p(t){const[a,s]=t.split("-").map(Number);return{year:a,month:s}}function M(t,a){return t*12+(a-1)}function A(t){const a=Math.floor(t/12);return String(a)}function V(){let t=0,a=0;for(;t===0;)t=Math.random();for(;a===0;)a=Math.random();return Math.sqrt(-2*Math.log(t))*Math.cos(2*Math.PI*a)}function l(t,a){if(t.length===0)return 0;const s=a/100*(t.length-1),n=Math.floor(s),h=Math.ceil(s);return n===h?t[n]:t[n]+(t[h]-t[n])*(s-n)}function F(t,a){const s=new Date,n=M(s.getFullYear(),s.getMonth()+1);let h=n,c=n+360;if(t.length>0){const e=t.map(i=>{const r=p(i.startDate);return M(r.year,r.month)}),d=t.filter(i=>i.endDate).map(i=>{const r=p(i.endDate);return M(r.year,r.month)});h=Math.min(n,...e),d.length>0&&(c=Math.max(c,...d));const f=t.filter(i=>i.type==="one-off").map(i=>{const r=p(i.startDate);return M(r.year,r.month)});f.length>0&&(c=Math.max(c,Math.max(...f)+12))}if(a){const e=p(a);c=M(e.year,e.month)}return{startAbs:h,endAbs:c}}function v(t,a){let s=0;for(const n of a){const h=p(n.startDate),c=M(h.year,h.month);if(n.type==="one-off"){t===c&&(s+=n.amount);continue}const e=n.endDate?p(n.endDate):null,d=e?M(e.year,e.month):1/0;if(!(t<c||t>d))if(t===c&&n.startingValue&&n.startingValue>0&&(s+=n.type==="recurring-withdrawal"?-n.startingValue:n.startingValue),n.frequency==="monthly")s+=n.type==="recurring-withdrawal"?-n.amount:n.amount;else{const f=t%12,i=c%12;f===i&&(s+=n.type==="recurring-withdrawal"?-n.amount:n.amount)}}return s}function Y(t,a,s){let n=0,h=0;for(const e of a){const d=p(e.startDate),f=M(d.year,d.month);if(e.type==="one-off"){t===f&&(n+=Math.abs(e.amount),h+=e.growthRate*Math.abs(e.amount));continue}const i=e.endDate?p(e.endDate):null,r=i?M(i.year,i.month):1/0;if(t>=f&&t<=r){const y=Math.abs(e.amount)+Math.abs(e.startingValue??0);n+=y,h+=e.growthRate*y}}return(n>0?h/n:s)/100/12}function q(t){const{startingBalance:a,cashFlows:s,volatility:n,numPaths:h,endOverride:c}=t,e=s.filter(o=>o.enabled),d=n/100/Math.sqrt(12),{startAbs:f,endAbs:i}=F(e,c),r=i-f;if(r<=0)return{timeSteps:[],finalMedian:a,finalP10:a,finalP25:a,finalP75:a,finalP90:a,finalDistribution:[a],survivalRate:100};const y=[];for(let o=0;o<h;o++){const u=new Array(r+1);u[0]=Math.max(0,a+v(f,e));for(let m=1;m<=r;m++){const b=f+m,I=v(b,e),R=Y(b,e,6)+d*V();let D=u[m-1]*(1+R)+I;D<0&&(D=0),u[m]=D}y.push(u)}const P=r<=60?1:12,w=[];for(let o=0;o<=r;o+=P){const u=y.map(m=>m[Math.min(o,r)]).sort((m,b)=>m-b);w.push({label:A(f+o),monthIndex:o,p10:Math.round(l(u,10)),p25:Math.round(l(u,25)),median:Math.round(l(u,50)),p75:Math.round(l(u,75)),p90:Math.round(l(u,90))})}const S=w[w.length-1];if(S&&S.monthIndex!==r){const o=y.map(u=>u[r]).sort((u,m)=>u-m);w.push({label:A(i),monthIndex:r,p10:Math.round(l(o,10)),p25:Math.round(l(o,25)),median:Math.round(l(o,50)),p75:Math.round(l(o,75)),p90:Math.round(l(o,90))})}const g=y.map(o=>o[r]).sort((o,u)=>o-u),x=g.filter(o=>o>0).length;return{timeSteps:w,finalMedian:Math.round(l(g,50)),finalP10:Math.round(l(g,10)),finalP25:Math.round(l(g,25)),finalP75:Math.round(l(g,75)),finalP90:Math.round(l(g,90)),finalDistribution:g,survivalRate:Math.round(x/g.length*100)}}function G(){return Math.random().toString(36).substring(2,10)+Date.now().toString(36)}function J(){const t=new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`}function C(t){const{year:a,month:s}=p(t);return`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][s-1]} ${a}`}export{J as c,C as f,G as g,p,q as r};

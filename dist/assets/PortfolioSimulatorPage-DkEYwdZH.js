import{r as i,j as e,f as b,u as Ze,c as Qe,b as es,d as Y,a as ss,e as as,g as he,h as ts,L as ns}from"./index-XQvDS8pc.js";import{f as U,c as $,r as ls,g as Ae}from"./simulationEngine-DmQAKyWZ.js";import{A as rs,D as is,af as cs,ao as os,ap as ds,aq as ps,ar as us,G as ie,as as hs,at as ms,au as ke,av as fs,aw as xs,Z as bs,L as gs,I as js,ax as vs,ay as Ns,az as H,aA as Ce,aB as ys,R as Oe,C as Pe,X as Ie,Y as $e,T as ws,J as Ss,aC as me}from"./CartesianChart-CpPoxbx3.js";import{A as ks,a as Z}from"./AreaChart-DQANAEYE.js";import{L as Cs,B as Ms,a as Ds}from"./BarChart-DhhkYR7w.js";class Es{constructor(a){var{x:n,y:t}=a;this.xAxisScale=n,this.yAxisScale=t}map(a,n){var t,c,{position:r}=n;return{x:(t=this.xAxisScale.map(a.x,{position:r}))!==null&&t!==void 0?t:0,y:(c=this.yAxisScale.map(a.y,{position:r}))!==null&&c!==void 0?c:0}}mapWithFallback(a,n){var t,c,{position:r,fallback:d}=n,p,u;return d==="rangeMin"?p=this.yAxisScale.rangeMin():d==="rangeMax"?p=this.yAxisScale.rangeMax():p=0,d==="rangeMin"?u=this.xAxisScale.rangeMin():d==="rangeMax"?u=this.xAxisScale.rangeMax():u=0,{x:(t=this.xAxisScale.map(a.x,{position:r}))!==null&&t!==void 0?t:u,y:(c=this.yAxisScale.map(a.y,{position:r}))!==null&&c!==void 0?c:p}}isInRange(a){var{x:n,y:t}=a,c=n==null||this.xAxisScale.isInRange(n),r=t==null||this.yAxisScale.isInRange(t);return c&&r}}function Me(s,a){var n=Object.keys(s);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(s);a&&(t=t.filter(function(c){return Object.getOwnPropertyDescriptor(s,c).enumerable})),n.push.apply(n,t)}return n}function De(s){for(var a=1;a<arguments.length;a++){var n=arguments[a]!=null?arguments[a]:{};a%2?Me(Object(n),!0).forEach(function(t){Ls(s,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(n)):Me(Object(n)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(n,t))})}return s}function Ls(s,a,n){return(a=As(a))in s?Object.defineProperty(s,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[a]=n,s}function As(s){var a=Os(s,"string");return typeof a=="symbol"?a:a+""}function Os(s,a){if(typeof s!="object"||!s)return s;var n=s[Symbol.toPrimitive];if(n!==void 0){var t=n.call(s,a);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}function de(){return de=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var n=arguments[a];for(var t in n)({}).hasOwnProperty.call(n,t)&&(s[t]=n[t])}return s},de.apply(null,arguments)}var Ps=(s,a)=>{var n;if(i.isValidElement(s))n=i.cloneElement(s,a);else if(typeof s=="function")n=s(a);else{if(!H(a.x1)||!H(a.y1)||!H(a.x2)||!H(a.y2))return null;n=i.createElement("line",de({},a,{className:"recharts-reference-line-line"}))}return n},Is=(s,a,n,t,c,r)=>{var{x:d,width:p}=r,u=c.map(s,{position:n});if(!H(u)||a==="discard"&&!c.isInRange(u))return null;var o=[{x:d+p,y:u},{x:d,y:u}];return t==="left"?o.reverse():o},$s=(s,a,n,t,c,r)=>{var{y:d,height:p}=r,u=c.map(s,{position:n});if(!H(u)||a==="discard"&&!c.isInRange(u))return null;var o=[{x:u,y:d+p},{x:u,y:d}];return t==="top"?o.reverse():o},Rs=(s,a,n,t)=>{var c=[t.mapWithFallback(s[0],{position:n,fallback:"rangeMin"}),t.mapWithFallback(s[1],{position:n,fallback:"rangeMax"})];return a==="discard"&&c.some(r=>!t.isInRange(r))?null:c},Fs=(s,a,n,t,c,r,d)=>{var{x:p,y:u,segment:o,ifOverflow:m}=d,y=Ce(p),x=Ce(u);return x?Is(u,m,t,r,a,n):y?$s(p,m,t,c,s,n):o!=null&&o.length===2?Rs(o,m,t,new Es({x:s,y:a})):null};function _s(s){var a=cs();return i.useEffect(()=>(a(os(s)),()=>{a(ds(s))})),null}function Vs(s){var{xAxisId:a,yAxisId:n,shape:t,className:c,ifOverflow:r}=s,d=ps(),p=us(),u=ie(w=>hs(w,a)),o=ie(w=>ms(w,n)),m=ie(w=>ke(w,"xAxis",a,d)),y=ie(w=>ke(w,"yAxis",n,d)),x=fs();if(!p||!x||u==null||o==null||m==null||y==null)return null;var g=Fs(m,y,x,s.position,u.orientation,o.orientation,s);if(!g)return null;var C=g[0],M=g[1];if(C==null||M==null)return null;var{x:A,y:j}=C,{x:D,y:E}=M,O=r==="hidden"?"url(#".concat(p,")"):void 0,L=De(De({clipPath:O},xs(s)),{},{x1:A,y1:j,x2:D,y2:E}),P=ys({x1:A,y1:j,x2:D,y2:E});return i.createElement(bs,{zIndex:s.zIndex},i.createElement(gs,{className:js("recharts-reference-line",c)},Ps(t,L),i.createElement(vs,de({},P,{lowerWidth:P.width,upperWidth:P.width}),i.createElement(Ns,{label:s.label}),s.children)))}var Ts={ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",label:!1,stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle",zIndex:is.line};function oe(s){var a=rs(s,Ts);return i.createElement(i.Fragment,null,i.createElement(_s,{yAxisId:a.yAxisId,xAxisId:a.xAxisId,ifOverflow:a.ifOverflow,x:a.x,y:a.y,segment:a.segment}),i.createElement(Vs,a))}oe.displayName="ReferenceLine";const Ws={"one-off":{icon:"ðŸŽ",label:"One-off Deposit",className:"ps-scenario-card--inflow"},"recurring-deposit":{icon:"ðŸ“¥",label:"Recurring Deposit",className:"ps-scenario-card--inflow"},"recurring-withdrawal":{icon:"ðŸ“¤",label:"Recurring Withdrawal",className:"ps-scenario-card--outflow"}};function zs({cashFlow:s,currencyCode:a,onEdit:n,onDelete:t,onToggle:c}){const r=Ws[s.type],d=s.type!=="one-off",p=s.frequency==="annually"?"/ year":"/ month",u=s.amount>0,o=(s.startingValue??0)>0,m=d&&!u&&o;return e.jsxs("div",{className:`ps-scenario-card ${r.className} ${s.enabled?"":"ps-scenario-card--disabled"}`,children:[e.jsxs("div",{className:"ps-scenario-card-actions",children:[e.jsx("button",{className:"ps-scenario-action-btn",onClick:()=>n(s.id),"aria-label":"Edit cash flow",children:"âœï¸"}),e.jsx("button",{className:"ps-scenario-action-btn",onClick:()=>t(s.id),"aria-label":"Delete cash flow",children:"ðŸ—‘ï¸"})]}),e.jsxs("div",{className:"ps-scenario-card-header",children:[e.jsxs("button",{className:`ps-scenario-toggle ${s.enabled?"ps-scenario-toggle--on":""}`,onClick:()=>c(s.id),"aria-label":s.enabled?"Disable cash flow":"Enable cash flow",children:[e.jsx("div",{className:"ps-scenario-toggle-track"}),e.jsx("div",{className:"ps-scenario-toggle-thumb"})]}),e.jsx("span",{className:"ps-scenario-icon",children:r.icon}),e.jsx("span",{className:"ps-scenario-type",children:s.label||r.label})]}),m?e.jsxs("div",{className:"ps-scenario-amount",children:[b(s.startingValue??0,a),e.jsx("span",{className:"ps-scenario-freq",children:" lump sum"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"ps-scenario-amount",children:[b(s.amount,a),d&&e.jsxs("span",{className:"ps-scenario-freq",children:[" ",p]})]}),d&&o&&e.jsxs("div",{className:"ps-scenario-growth",children:[s.type==="recurring-withdrawal"?"Lump at start:":"Starting value:"," ",b(s.startingValue??0,a)]})]}),e.jsx("div",{className:"ps-scenario-dates",children:d?e.jsxs(e.Fragment,{children:[U(s.startDate)," â†’ ",s.endDate?U(s.endDate):"âˆž"]}):U(s.startDate)}),e.jsxs("div",{className:"ps-scenario-growth",children:["Growth: ",s.growthRate,"%"]})]})}const pe="#8b5cf6",G="#10b981",Q="#22d3ee";function Gs({active:s,payload:a,label:n,currencyCode:t}){var r;if(!s||!(a!=null&&a.length))return null;const c=(r=a[0])==null?void 0:r.payload;return c?e.jsxs("div",{className:"ps-tooltip",children:[e.jsx("p",{className:"ps-tooltip-title",children:n}),e.jsxs("p",{className:"ps-tooltip-row ps-tooltip-row--p90",children:[e.jsx("span",{className:"ps-tooltip-swatch",style:{background:pe}}),"90th: ",b(c.p90,t)]}),e.jsxs("p",{className:"ps-tooltip-row ps-tooltip-row--p75",children:[e.jsx("span",{className:"ps-tooltip-swatch",style:{background:G}}),"75th: ",b(c.p75,t)]}),e.jsxs("p",{className:"ps-tooltip-row ps-tooltip-row--median",children:[e.jsx("span",{className:"ps-tooltip-swatch",style:{background:Q}}),"Median: ",b(c.median,t)]}),e.jsxs("p",{className:"ps-tooltip-row ps-tooltip-row--p25",children:[e.jsx("span",{className:"ps-tooltip-swatch",style:{background:G}}),"25th: ",b(c.p25,t)]}),e.jsxs("p",{className:"ps-tooltip-row ps-tooltip-row--p10",children:[e.jsx("span",{className:"ps-tooltip-swatch",style:{background:pe}}),"10th: ",b(c.p10,t)]})]}):null}function Bs(s,a=30){if(!s.length)return[];const n=s[0],t=s[s.length-1];if(n===t)return[{binStart:n,binEnd:t,count:s.length,label:""}];const c=(t-n)/a,r=[];for(let d=0;d<a;d++){const p=n+d*c,u=p+c;r.push({binStart:p,binEnd:u,count:0,label:""})}for(const d of s){let p=Math.floor((d-n)/c);p>=a&&(p=a-1),p<0&&(p=0),r[p].count++}for(const d of r){const p=(d.binStart+d.binEnd)/2;p>=1e6?d.label=`${(p/1e6).toFixed(1)}M`:p>=1e3?d.label=`${(p/1e3).toFixed(0)}K`:d.label=String(Math.round(p))}return r}function fe(s,a){if(!s.length)return 0;const n=a/100*(s.length-1),t=Math.floor(n),c=Math.ceil(n);return t===c?s[t]:s[t]+(s[c]-s[t])*(n-t)}function qs({distribution:s,currencyCode:a,hoveredLabel:n}){var p,u,o;const t=i.useMemo(()=>Bs(s,30),[s]),c=i.useMemo(()=>fe(s,25),[s]),r=i.useMemo(()=>fe(s,50),[s]),d=i.useMemo(()=>fe(s,75),[s]);return t.length?e.jsxs("div",{className:"ps-dist-view",children:[e.jsxs("div",{className:"ps-dist-header",children:[e.jsxs("h3",{className:"ps-dist-title",children:["Outcome Distribution â€” ",n||"End of Horizon"]}),e.jsx("p",{className:"ps-dist-subtitle",children:"Each bar shows how many simulations landed in that value range. Highlighted regions mark the key percentiles."})]}),e.jsxs("div",{className:"ps-dist-stats",children:[e.jsxs("div",{className:"ps-dist-stat",children:[e.jsx("span",{className:"ps-dist-stat-label",style:{color:"#eab308"},children:"25th (Pessimistic)"}),e.jsx("span",{className:"ps-dist-stat-value",children:b(Math.round(c),a)})]}),e.jsxs("div",{className:"ps-dist-stat",children:[e.jsx("span",{className:"ps-dist-stat-label",style:{color:Q},children:"Median (Expected)"}),e.jsx("span",{className:"ps-dist-stat-value",children:b(Math.round(r),a)})]}),e.jsxs("div",{className:"ps-dist-stat",children:[e.jsx("span",{className:"ps-dist-stat-label",style:{color:G},children:"75th (Optimistic)"}),e.jsx("span",{className:"ps-dist-stat-value",children:b(Math.round(d),a)})]})]}),e.jsx("div",{className:"ps-chart-container",children:e.jsx(Oe,{width:"100%",height:300,children:e.jsxs(Ms,{data:t,margin:{top:20,right:10,left:10,bottom:5},children:[e.jsx(Pe,{strokeDasharray:"3 3",stroke:"var(--border-color)",vertical:!1}),e.jsx(Ie,{dataKey:"label",tick:{fill:"var(--text-muted)",fontSize:10},axisLine:{stroke:"var(--border-color)"},tickLine:!1,interval:Math.max(0,Math.floor(t.length/6)-1)}),e.jsx($e,{tick:{fill:"var(--text-muted)",fontSize:11},axisLine:!1,tickLine:!1}),e.jsx(Ds,{dataKey:"count",radius:[2,2,0,0],animationDuration:400,children:t.map((m,y)=>{const x=(m.binStart+m.binEnd)/2;let g="rgba(139, 92, 246, 0.5)";return x>=c&&x<=d&&(g="rgba(16, 185, 129, 0.6)"),e.jsx(Ss,{fill:g},y)})}),e.jsx(oe,{x:(p=t.find(m=>(m.binStart+m.binEnd)/2>=r))==null?void 0:p.label,stroke:Q,strokeWidth:2,strokeDasharray:"4 4",children:e.jsx(me,{value:"Median",position:"top",fill:Q,fontSize:11})}),e.jsx(oe,{x:(u=t.find(m=>(m.binStart+m.binEnd)/2>=c))==null?void 0:u.label,stroke:"#eab308",strokeWidth:1.5,strokeDasharray:"4 4",children:e.jsx(me,{value:"25th",position:"top",fill:"#eab308",fontSize:10})}),e.jsx(oe,{x:(o=t.find(m=>(m.binStart+m.binEnd)/2>=d))==null?void 0:o.label,stroke:G,strokeWidth:1.5,strokeDasharray:"4 4",children:e.jsx(me,{value:"75th",position:"top",fill:G,fontSize:10})})]})})})]}):null}function Ks({data:s,result:a,currencyCode:n}){const[t,c]=i.useState(!1),[r,d]=i.useState(""),p=i.useMemo(()=>s.map(o=>({...o,p10_base:o.p10,band_10_25:Math.max(0,o.p25-o.p10),band_25_75:Math.max(0,o.p75-o.p25),band_75_90:Math.max(0,o.p90-o.p75)})),[s]),u=i.useCallback(o=>{o!=null&&o.activeLabel&&d(o.activeLabel)},[]);return s.length?e.jsxs("div",{className:`ps-flip-container ${t?"ps-flip-container--flipped":""}`,children:[e.jsxs("div",{className:"ps-flip-face ps-flip-face--front",children:[e.jsxs("div",{className:"ps-flip-header",children:[e.jsx("h2",{className:"ps-card-title",children:"Monte Carlo Simulation"}),e.jsx("button",{className:"ps-flip-btn",onClick:()=>c(!0),title:"Show outcome distribution",children:"ðŸ“Š Distribution"})]}),e.jsx("div",{className:"ps-chart-container",children:e.jsx(Oe,{width:"100%",height:380,children:e.jsxs(ks,{data:p,margin:{top:10,right:10,left:10,bottom:0},onMouseMove:u,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"outerBandGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:pe,stopOpacity:.4}),e.jsx("stop",{offset:"100%",stopColor:pe,stopOpacity:.08})]}),e.jsxs("linearGradient",{id:"innerBandGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:G,stopOpacity:.5}),e.jsx("stop",{offset:"100%",stopColor:G,stopOpacity:.12})]})]}),e.jsx(Pe,{strokeDasharray:"3 3",stroke:"var(--border-color)",vertical:!1}),e.jsx(Ie,{dataKey:"label",tick:{fill:"var(--text-muted)",fontSize:11},axisLine:{stroke:"var(--border-color)"},tickLine:!1,interval:"preserveStartEnd"}),e.jsx($e,{tick:{fill:"var(--text-muted)",fontSize:11},axisLine:!1,tickLine:!1,tickFormatter:o=>o>=1e6?`${(o/1e6).toFixed(1)}M`:o>=1e3?`${(o/1e3).toFixed(0)}K`:String(o)}),e.jsx(ws,{content:e.jsx(Gs,{currencyCode:n}),cursor:{stroke:"rgba(255,255,255,0.1)"}}),e.jsx(Z,{dataKey:"p10_base",stackId:"bands",stroke:"none",fill:"transparent",legendType:"none",animationDuration:600}),e.jsx(Z,{dataKey:"band_10_25",stackId:"bands",stroke:"none",fill:"url(#outerBandGrad)",name:"10thâ€“90th",animationDuration:600}),e.jsx(Z,{dataKey:"band_25_75",stackId:"bands",stroke:"none",fill:"url(#innerBandGrad)",name:"25thâ€“75th",animationDuration:600}),e.jsx(Z,{dataKey:"band_75_90",stackId:"bands",stroke:"none",fill:"url(#outerBandGrad)",legendType:"none",animationDuration:600}),e.jsx(Z,{dataKey:"median",stroke:Q,strokeWidth:2.5,fill:"none",name:"Median",dot:!1,animationDuration:800}),e.jsx(Cs,{wrapperStyle:{fontSize:12,color:"var(--text-secondary)"}})]})})})]}),e.jsxs("div",{className:"ps-flip-face ps-flip-face--back",children:[e.jsx("div",{className:"ps-flip-header",children:e.jsx("button",{className:"ps-flip-btn",onClick:()=>c(!1),title:"Show Monte Carlo chart",children:"ðŸ“ˆ Monte Carlo"})}),e.jsx(qs,{distribution:a.finalDistribution,currencyCode:n,hoveredLabel:r})]})]}):null}function ce(s){const[a,n]=s.split("-").map(Number);return a+(n-1)/12}function Ys(s,a){const n=a-s;let t=1;n>25?t=5:n>12?t=3:n>6&&(t=2);const c=[],r=Math.ceil(s/t)*t;for(let d=r;d<=a;d+=t)c.push(d);return c}const Re={"one-off":{sign:"+",colorClass:"ps-tl-bar--inflow"},"recurring-deposit":{sign:"+",colorClass:"ps-tl-bar--inflow"},"recurring-withdrawal":{sign:"âˆ’",colorClass:"ps-tl-bar--outflow"}};function Fe(s,a){const n=Re[s.type],t=s.type!=="one-off",c=s.amount>0,r=(s.startingValue??0)>0;if(t&&!c&&r)return`${n.sign}${b(s.startingValue,a)} lump`;const d=s.type==="one-off"?"":s.frequency==="annually"?"/yr":"/mo";return`${n.sign}${b(s.amount,a)}${d}`}function Hs(s,a){const n=[s.label];if(n.push(Fe(s,a)),s.type!=="one-off"&&(s.startingValue??0)>0){const t=b(s.startingValue,a);n.push(s.type==="recurring-withdrawal"?`Lump: ${t}`:`Starting: ${t}`)}return s.type==="one-off"?n.push(U(s.startDate)):n.push(`${U(s.startDate)} â†’ ${s.endDate?U(s.endDate):"âˆž"}`),n.push(`Growth: ${s.growthRate}%`),n.join(`
`)}function Us({cashFlows:s,simulationEnd:a,currencyCode:n,onEdit:t}){const[c,r]=i.useState(!1);if(s.length===0)return null;const d=$(),p=ce(d),u=ce(a),o=Math.max(1,u-p),m=Ys(Math.floor(p),Math.ceil(u)),y=[...s].sort((x,g)=>{const C={"one-off":0,"recurring-deposit":1,"recurring-withdrawal":2};return C[x.type]-C[g.type]});return e.jsxs("div",{className:"ps-card ps-tl-card",children:[e.jsx("div",{className:"ps-tl-header",children:e.jsxs("button",{className:"ps-table-toggle",onClick:()=>r(x=>!x),"aria-expanded":c,children:[e.jsx("span",{children:"Timeline"}),e.jsx("span",{className:`ps-table-arrow ${c?"ps-table-arrow--open":""}`,children:"â–¼"})]})}),e.jsx("div",{className:`ps-tl-body ${c?"ps-tl-body--open":""}`,children:e.jsxs("div",{className:"ps-tl-content",children:[e.jsx("div",{className:"ps-tl-rows",children:y.map(x=>{const g=Re[x.type],C=ce(x.startDate),M=x.endDate?ce(x.endDate):C,A=Math.max(0,(C-p)/o*100),j=(M-C)/o*100,D=Math.max(5,j),E=Math.min(D,100-A),O=E<18,L=Fe(x,n);return e.jsx("div",{className:"ps-tl-row",title:Hs(x,n),children:e.jsx("div",{className:`ps-tl-bar ${g.colorClass} ${x.enabled?"":"ps-tl-bar--disabled"} ${t?"ps-tl-bar--clickable":""}`,style:{left:`${A}%`,width:`${E}%`},onClick:t?()=>t(x.id):void 0,role:t?"button":void 0,tabIndex:t?0:void 0,onKeyDown:t?P=>{(P.key==="Enter"||P.key===" ")&&t(x.id)}:void 0,children:O?e.jsx("span",{className:"ps-tl-bar-amount",children:L}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"ps-tl-bar-label",children:x.label}),e.jsx("span",{className:"ps-tl-bar-amount",children:L})]})})},x.id)})}),e.jsx("div",{className:"ps-tl-axis",children:m.map(x=>{const g=(x-p)/o*100;return e.jsx("span",{className:"ps-tl-axis-label",style:{left:`${g}%`},children:x},x)})})]})})]})}function z(s,a){const[n,t]=s.split("-").map(Number),c=n*12+(t-1)+a,r=Math.floor(c/12),d=c%12+1;return`${r}-${String(d).padStart(2,"0")}`}function Ee(){try{const s=localStorage.getItem("vibe-finance-sim-default-years"),a=Number(s);if(!Number.isNaN(a))return Math.min(60,Math.max(5,Math.round(a)))}catch{}return 35}function Le({value:s,onChange:a,symbol:n,ariaLabel:t}){const[c,r]=i.useState(s.toLocaleString("en-GB"));i.useEffect(()=>{r(s.toLocaleString("en-GB"))},[s]);const d=()=>{const p=Number(c.replace(/,/g,""));isNaN(p)?r(s.toLocaleString("en-GB")):a(p)};return e.jsxs("div",{className:"ps-currency-input",children:[e.jsx("span",{className:"ps-currency-prefix",children:n}),e.jsx("input",{type:"text",inputMode:"numeric",value:c,onChange:p=>r(p.target.value),onBlur:d,"aria-label":t})]})}function _e({value:s,onChange:a,suffix:n,ariaLabel:t,min:c=0,max:r}){const[d,p]=i.useState(String(s));i.useEffect(()=>{p(String(s))},[s]);const u=()=>{let o=Number(d);if(isNaN(o)){p(String(s));return}c!==void 0&&(o=Math.max(c,o)),r!==void 0&&(o=Math.min(r,o)),a(o)};return e.jsxs("div",{className:"ps-numeric-input",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:d,onChange:o=>p(o.target.value),onBlur:u,"aria-label":t}),n&&e.jsx("span",{className:"ps-numeric-suffix",children:n})]})}function xe({value:s,onChange:a,ariaLabel:n}){return e.jsx("input",{type:"month",className:"ps-month-input",value:s,onChange:t=>a(t.target.value),"aria-label":n})}function Xs({initial:s,currencySymbol:a,savedLabels:n,onSave:t,onCancel:c,onDirtyChange:r,onRegisterSubmit:d,onLabelSaved:p,onLabelDeleted:u}){const o=!!s,[m,y]=i.useState((s==null?void 0:s.type)??"recurring-deposit"),[x,g]=i.useState((s==null?void 0:s.label)??""),[C,M]=i.useState(!1),A=i.useRef(null),[j,D]=i.useState((s==null?void 0:s.amount)??0),[E,O]=i.useState((s==null?void 0:s.startingValue)??0),[L,P]=i.useState((s==null?void 0:s.growthRate)??5),[w,V]=i.useState((s==null?void 0:s.startDate)??$()),[R,B]=i.useState((s==null?void 0:s.endDate)??z($(),180)),[F,W]=i.useState((s==null?void 0:s.frequency)??"monthly"),[ue,q]=i.useState(!1);i.useEffect(()=>{o||(g(""),D(0),O(0),P(5),V($()),B(z($(),180)),W("monthly"))},[m,o]);const v=m!=="one-off",k=i.useMemo(()=>s?{type:s.type,label:s.label??"",amount:s.amount,startingValue:s.startingValue??0,growthRate:s.growthRate,startDate:s.startDate,endDate:s.endDate??z($(),180),frequency:s.frequency??"monthly"}:{type:m,label:"",amount:0,startingValue:0,growthRate:5,startDate:$(),endDate:z($(),180),frequency:"monthly"},[s,m]),ee=i.useMemo(()=>{const N=m!==k.type||x!==k.label||j!==k.amount||L!==k.growthRate||w!==k.startDate;return v?N||E!==k.startingValue||R!==k.endDate||F!==k.frequency:N},[m,x,j,L,w,v,E,R,F,k]);i.useEffect(()=>{r==null||r(ee)},[ee,r]),i.useEffect(()=>()=>{r==null||r(!1)},[r]);const X=()=>{if(v&&j<=0&&E<=0){q(!0);return}if(!v&&j<=0){q(!0);return}const N=x||(m==="one-off"?"One-off":m==="recurring-deposit"?"Deposit":"Withdrawal");x.trim()&&(p==null||p(x.trim())),t({id:(s==null?void 0:s.id)??Ae(),type:m,label:N,amount:j,startingValue:v?E:void 0,growthRate:L,startDate:w,endDate:v?R:void 0,frequency:v?F:void 0,enabled:(s==null?void 0:s.enabled)??!0})};return i.useEffect(()=>(d==null||d(X),()=>d==null?void 0:d(null)),[d,X]),e.jsxs("div",{className:"ps-scenario-form",children:[e.jsx("h3",{className:"ps-form-title",children:o?"Edit Cash Flow":"New Cash Flow"}),!o&&e.jsxs("div",{className:"ps-field",children:[e.jsx("label",{className:"ps-label",children:"Type"}),e.jsxs("div",{className:"ps-type-selector",children:[e.jsx("button",{className:`ps-type-btn ps-type-btn--inflow ${m==="recurring-deposit"?"ps-type-btn--active":""}`,onClick:()=>y("recurring-deposit"),children:"ðŸ“¥ Deposit"}),e.jsx("button",{className:`ps-type-btn ps-type-btn--outflow ${m==="recurring-withdrawal"?"ps-type-btn--active":""}`,onClick:()=>y("recurring-withdrawal"),children:"ðŸ“¤ Withdrawal"}),e.jsx("button",{className:`ps-type-btn ps-type-btn--inflow ${m==="one-off"?"ps-type-btn--active":""}`,onClick:()=>y("one-off"),children:"ðŸŽ One-off"})]})]}),e.jsxs("div",{className:"ps-field",children:[e.jsx("label",{className:"ps-label",children:"Label"}),e.jsxs("div",{className:"ps-label-combo",children:[e.jsx("input",{ref:A,type:"text",className:"ps-text-input",value:x,onChange:N=>{g(N.target.value),M(!0)},onFocus:()=>M(!0),onBlur:()=>{setTimeout(()=>M(!1),150)},placeholder:"e.g. Inheritance, Pension, Salary...","aria-label":"Cash flow label"}),C&&n.length>0&&e.jsx("div",{className:"ps-label-dropdown",children:n.filter(N=>!x||N.toLowerCase().includes(x.toLowerCase())).map(N=>e.jsxs("div",{className:"ps-label-dropdown-item",children:[e.jsx("button",{className:"ps-label-dropdown-pick",onMouseDown:_=>{_.preventDefault(),g(N),M(!1)},children:N}),e.jsx("button",{className:"ps-label-dropdown-del",onMouseDown:_=>{_.preventDefault(),u==null||u(N)},"aria-label":`Remove ${N}`,children:"Ã—"})]},N))})]})]}),v&&e.jsxs("div",{className:"ps-field",children:[e.jsx("label",{className:"ps-label",children:m==="recurring-withdrawal"?"Lump Withdrawal":"Starting Value"}),e.jsx(Le,{value:E,onChange:O,symbol:a,ariaLabel:m==="recurring-withdrawal"?"Lump withdrawal amount":"Starting value amount"})]}),e.jsxs("div",{className:"ps-field",children:[e.jsxs("label",{className:"ps-label",children:["Amount",v?` (${F==="monthly"?"per month":"per year"})`:""]}),e.jsx(Le,{value:j,onChange:D,symbol:a,ariaLabel:"Cash flow amount"})]}),v&&e.jsxs("div",{className:"ps-field",children:[e.jsx("label",{className:"ps-label",children:"Frequency"}),e.jsxs("div",{className:"ps-toggle",children:[e.jsx("button",{className:`ps-toggle-btn ${F==="monthly"?"ps-toggle-btn--active":""}`,onClick:()=>W("monthly"),children:"Monthly"}),e.jsx("button",{className:`ps-toggle-btn ${F==="annually"?"ps-toggle-btn--active":""}`,onClick:()=>W("annually"),children:"Annually"})]})]}),e.jsxs("div",{className:"ps-field",children:[e.jsx("label",{className:"ps-label",children:v?"Start Date":"Date"}),e.jsx(xe,{value:w,onChange:V,ariaLabel:"Start date"})]}),v&&e.jsxs("div",{className:"ps-field",children:[e.jsx("label",{className:"ps-label",children:"End Date"}),e.jsx(xe,{value:R,onChange:B,ariaLabel:"End date"})]}),e.jsxs("div",{className:"ps-field",children:[e.jsx("label",{className:"ps-label",children:"Annual Growth Rate"}),e.jsx(_e,{value:L,onChange:P,suffix:"%",ariaLabel:"Annual growth rate",min:0,max:50})]}),e.jsxs("div",{className:"ps-form-actions",children:[e.jsx("button",{className:"ps-btn ps-btn--secondary",onClick:c,children:"Cancel"}),e.jsx("button",{className:"ps-btn ps-btn--primary",onClick:X,children:o?"Save Changes":"Add Cash Flow"})]}),ue&&e.jsx("div",{className:"confirm-overlay",onClick:()=>q(!1),children:e.jsxs("div",{className:"confirm-dialog ps-empty-warning",onClick:N=>N.stopPropagation(),children:[e.jsx("div",{className:"ps-empty-warning-icon",children:"âš ï¸"}),e.jsx("p",{className:"confirm-message",children:v?"Please enter a periodic amount or a lump sum before saving.":"Please enter an amount before saving."}),e.jsx("div",{className:"confirm-actions",children:e.jsx("button",{className:"confirm-btn confirm-btn--save",onClick:()=>q(!1),children:"Got it"})})]})})]})}function aa(){const{currency:s}=Ze(),{user:a}=Qe(),n=es(),[t,c]=Y("vf-ps-sim-end",()=>z($(),Ee()*12)),[r,d]=Y("vf-ps-cash-flows",[]),[p,u]=Y("vf-ps-scenarios",[]),[o,m]=Y("vf-ps-active-id",null),[y,x]=i.useState("all"),[g]=i.useState(12),C=500,[M,A]=i.useState(!1),[j,D]=i.useState(null),[E,O]=i.useState(!1),L=i.useRef(null),P=i.useRef(null),w=i.useRef(null),[V,R]=i.useState(null),[B,F]=Y("vf-ps-horizon-mode","years"),[W,ue]=i.useState(!1),[q,v]=i.useState(!1),{gate:k,showLogin:ee,onLoginSuccess:X,onLoginClose:N}=ss(),[_,be]=i.useState(""),[Ve,se]=i.useState(!1),[J,ge]=i.useState(""),[Te,je]=Y("vf-ps-labels",[]),S=p.find(l=>l.id===o)??null,ae=i.useMemo(()=>S?S.simulationEnd!==t||JSON.stringify(S.cashFlows)!==JSON.stringify(r):r.length>0,[S,t,r]);i.useEffect(()=>{if(!a)return;let l=!1;return as(a.uid).then(h=>{l||h.length===0||u(f=>{const T=new Set(f.map(K=>K.id)),re=[...f];for(const K of h)if(!T.has(K.id))re.push(K);else{const Se=re.findIndex(Je=>Je.id===K.id);Se!==-1&&(re[Se]=K)}return re})}).catch(h=>console.error("[scenarios] fetch failed:",h)),()=>{l=!0}},[a,u]);const I=i.useMemo(()=>r.length===0?null:ls({startingBalance:0,cashFlows:r,volatility:g,numPaths:C,endOverride:t}),[r,g,C,t]),ve=i.useCallback(l=>{k(()=>{const h={id:Ae(),name:l,startingBalance:0,simulationEnd:t,cashFlows:[...r]};u(f=>[...f,h]),m(h.id),a&&he(a.uid,h).catch(f=>console.error("[scenarios] save-as failed:",f))})},[a,k,t,r,u,m]),We=i.useCallback(()=>{o&&k(()=>{const l={id:o,name:(S==null?void 0:S.name)??"Scenario",startingBalance:0,simulationEnd:t,cashFlows:[...r]};u(h=>h.map(f=>f.id===o?l:f)),a&&he(a.uid,l).catch(h=>console.error("[scenarios] save failed:",h))})},[a,k,o,S,t,r,u]),ze=i.useCallback(l=>{const h=p.find(f=>f.id===l);h&&(m(l),c(h.simulationEnd),d(h.cashFlows))},[p,m,c,d]),te=i.useCallback(()=>{m(null),c(z($(),Ee()*12)),d([]),A(!1),D(null)},[m,c,d]),Ge=i.useCallback(l=>{u(h=>h.filter(f=>f.id!==l)),a&&ts(a.uid,l).catch(h=>console.error("[scenarios] delete failed:",h)),o===l&&te()},[a,o,u,te]),Ne=i.useCallback(l=>{if(!(!o||!l.trim())){if(u(h=>h.map(f=>f.id===o?{...f,name:l.trim()}:f)),a){const h=p.find(f=>f.id===o);h&&he(a.uid,{...h,name:l.trim()}).catch(f=>console.error("[scenarios] rename failed:",f))}se(!1)}},[a,o,p,u]),ne=i.useCallback(()=>{setTimeout(()=>{var l;(l=P.current)==null||l.scrollIntoView({behavior:"smooth",block:"start"})},50)},[]),le=i.useCallback(l=>{const h=r.find(f=>f.id===l);h&&(O(!1),D(h),A(!0),ne())},[r,ne]),Be=i.useCallback(()=>{O(!1),D(null),A(!0),ne()},[ne]),ye=i.useCallback(l=>{if(!(M&&(j==null?void 0:j.id)===l)){if(M&&E){R(l);return}le(l)}},[M,j,E,le]),qe=i.useCallback(()=>{var l;w.current=V,R(null),(l=L.current)==null||l.call(L)},[V]),Ke=i.useCallback(()=>{const l=V;R(null),l&&le(l)},[V,le]),we=i.useCallback(()=>{R(null)},[]),Ye=i.useCallback(l=>{d(h=>h.filter(f=>f.id!==l))},[d]),He=i.useCallback(l=>{d(h=>h.map(f=>f.id===l?{...f,enabled:!f.enabled}:f))},[d]),Ue=i.useCallback(l=>{d(j?f=>f.map(T=>T.id===l.id?l:T):f=>[...f,l]),O(!1);const h=w.current;if(h){w.current=null;const f=r.find(T=>T.id===h);if(f){D(f);return}}A(!1),D(null)},[j,d,r]),Xe=i.useCallback(()=>{O(!1),A(!1),D(null)},[]);return e.jsxs("div",{className:"ps-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{className:"page-title",children:"Portfolio Simulator"}),e.jsx("p",{className:"page-subtitle",children:"Simulate your financial future with Monte Carlo analysis."})]}),e.jsxs("div",{className:"ps-grid",children:[e.jsxs("div",{className:"ps-left",children:[e.jsxs("div",{className:"ps-card ps-scn-card",children:[e.jsxs("div",{className:"ps-scn-header",children:[e.jsx("h2",{className:"ps-card-title",children:"ðŸ“‹ Scenario"}),S&&!ae&&e.jsx("span",{className:"ps-scn-badge ps-scn-badge--saved",children:"Saved"}),ae&&e.jsx("span",{className:"ps-scn-badge ps-scn-badge--dirty",children:"Unsaved"})]}),p.length>0&&e.jsxs("select",{className:"ps-scn-select",value:o??"",onChange:l=>l.target.value?ze(l.target.value):te(),children:[e.jsx("option",{value:"",children:"â€” New scenario â€”"}),p.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]}),q?e.jsxs("div",{className:"ps-scn-save-row",children:[e.jsx("input",{className:"ps-text-input",placeholder:"Scenario nameâ€¦",value:_,onChange:l=>be(l.target.value),onKeyDown:l=>{l.key==="Enter"&&_.trim()&&(ve(_.trim()),v(!1)),l.key==="Escape"&&v(!1)},autoFocus:!0}),e.jsx("button",{className:"ps-btn ps-btn--primary",disabled:!_.trim(),onClick:()=>{ve(_.trim()),v(!1)},children:"Save"}),e.jsx("button",{className:"ps-btn ps-btn--secondary",onClick:()=>v(!1),children:"Cancel"})]}):Ve?e.jsxs("div",{className:"ps-scn-save-row",children:[e.jsx("input",{className:"ps-text-input",placeholder:"New nameâ€¦",value:J,onChange:l=>ge(l.target.value),onKeyDown:l=>{l.key==="Enter"&&J.trim()&&Ne(J),l.key==="Escape"&&se(!1)},autoFocus:!0}),e.jsx("button",{className:"ps-btn ps-btn--primary",disabled:!J.trim(),onClick:()=>Ne(J),children:"Rename"}),e.jsx("button",{className:"ps-btn ps-btn--secondary",onClick:()=>se(!1),children:"Cancel"})]}):e.jsxs("div",{className:"ps-scn-actions",children:[o&&ae&&e.jsx("button",{className:"ps-btn ps-btn--primary",onClick:We,children:"ðŸ’¾ Save"}),e.jsx("button",{className:"ps-btn ps-btn--secondary",onClick:()=>{v(!0),be(S!=null&&S.name?`${S.name} copy`:"")},children:"Save asâ€¦"}),e.jsx("button",{className:"ps-btn ps-btn--secondary",onClick:te,children:"+ New"}),o&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"ps-btn ps-btn--secondary",onClick:()=>{se(!0),ge((S==null?void 0:S.name)??"")},children:"âœï¸"}),e.jsx("button",{className:"ps-btn ps-btn--secondary ps-btn--danger",onClick:()=>Ge(o),children:"ðŸ—‘ï¸"})]})]}),!a&&e.jsx("button",{className:"ps-login-prompt",onClick:()=>k(()=>{}),children:"ðŸ”’ Sign in to save scenarios to your account"}),o&&!ae&&e.jsx("button",{className:"ps-btn ps-btn--gold ps-generate-report-cta",onClick:()=>n("/reports"),children:"ðŸ“Š Generate Report"})]}),e.jsxs("div",{className:"ps-card",children:[e.jsx("h2",{className:"ps-card-title",children:"Simulation Setup"}),e.jsxs("div",{className:"ps-field",children:[e.jsxs("div",{className:"ps-label-row",children:[e.jsx("label",{className:"ps-label",children:"Horizon"}),e.jsxs("div",{className:"ps-toggle ps-toggle--sm",children:[e.jsx("button",{className:`ps-toggle-btn ${B==="years"?"ps-toggle-btn--active":""}`,onClick:()=>F("years"),children:"Years"}),e.jsx("button",{className:`ps-toggle-btn ${B==="date"?"ps-toggle-btn--active":""}`,onClick:()=>F("date"),children:"Date"})]})]}),B==="years"?e.jsx(_e,{value:(()=>{const[l,h]=t.split("-").map(Number),f=new Date,T=l*12+h-(f.getFullYear()*12+(f.getMonth()+1));return Math.max(1,Math.round(T/12))})(),onChange:l=>c(z($(),Math.round(l*12))),suffix:"years",ariaLabel:"Simulation horizon in years",min:1,max:100}):e.jsx(xe,{value:t,onChange:c,ariaLabel:"Simulation end date"})]}),e.jsx("button",{className:"ps-btn ps-btn--gold ps-btn--full",onClick:Be,children:"+ Add Cash Flow"})]}),M&&e.jsx("div",{className:"ps-card ps-card--form",ref:P,children:e.jsx(Xs,{initial:j??void 0,currencySymbol:s.symbol,savedLabels:Te,onSave:Ue,onCancel:Xe,onDirtyChange:O,onRegisterSubmit:l=>{L.current=l},onLabelSaved:l=>je(h=>h.includes(l)?h:[...h,l].sort()),onLabelDeleted:l=>je(h=>h.filter(f=>f!==l))})}),r.length>0&&e.jsxs("div",{className:"ps-card",children:[e.jsxs("h2",{className:"ps-card-title",children:["Cash Flows",e.jsx("span",{className:"ps-scenario-count",children:r.length})]}),e.jsx("div",{className:"ps-filter",children:["all","deposits","withdrawals"].map(l=>e.jsx("button",{className:`ps-filter-btn ${y===l?"ps-filter-btn--active":""}`,onClick:()=>x(l),children:l==="all"?"All":l==="deposits"?"ðŸ“¥ Deposits":"ðŸ“¤ Withdrawals"},l))}),e.jsx("div",{className:"ps-scenario-list",children:r.filter(l=>y==="all"?!0:y==="deposits"?l.type!=="recurring-withdrawal":l.type==="recurring-withdrawal").map(l=>e.jsx(zs,{cashFlow:l,currencyCode:s.code,onEdit:ye,onDelete:Ye,onToggle:He},l.id))})]})]}),e.jsxs("div",{className:"ps-right",children:[I&&e.jsxs("div",{className:"ps-card ps-results-card",children:[e.jsx("h2",{className:"ps-card-title",children:"Results"}),e.jsxs("div",{className:"ps-results-grid",children:[e.jsxs("div",{className:"ps-result-item",children:[e.jsx("span",{className:"ps-result-label",children:"Median (Expected)"}),e.jsx("span",{className:"ps-result-value ps-result-value--cyan",children:b(I.finalMedian,s.code)})]}),e.jsxs("div",{className:"ps-result-item",children:[e.jsx("span",{className:"ps-result-label",children:"Optimistic (75th)"}),e.jsx("span",{className:"ps-result-value ps-result-value--green",children:b(I.finalP75,s.code)})]}),e.jsxs("div",{className:"ps-result-item",children:[e.jsx("span",{className:"ps-result-label",children:"Pessimistic (25th)"}),e.jsx("span",{className:"ps-result-value ps-result-value--yellow",children:b(I.finalP25,s.code)})]})]})]}),I&&I.timeSteps.length>0&&e.jsx("div",{className:"ps-card ps-chart-card",children:e.jsx(Ks,{data:I.timeSteps,result:I,currencyCode:s.code})}),r.length>0&&e.jsx(Us,{cashFlows:r,simulationEnd:t,currencyCode:s.code,onEdit:ye}),I&&I.timeSteps.length>0&&e.jsxs("div",{className:"ps-card ps-table-card",children:[e.jsx("div",{className:"ps-table-header",children:e.jsxs("button",{className:"ps-table-toggle",onClick:()=>ue(l=>!l),"aria-expanded":W,children:[e.jsx("span",{children:"Table"}),e.jsx("span",{className:`ps-table-arrow ${W?"ps-table-arrow--open":""}`,children:"â–¼"})]})}),e.jsx("div",{className:`ps-table-body ${W?"ps-table-body--open":""}`,children:e.jsx("div",{className:"ps-table-scroll",children:e.jsxs("table",{className:"ps-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"ps-th ps-th--left",children:"Year"}),e.jsx("th",{className:"ps-th ps-th--right",children:"10th"}),e.jsx("th",{className:"ps-th ps-th--right",children:"25th"}),e.jsx("th",{className:"ps-th ps-th--right",children:"Median"}),e.jsx("th",{className:"ps-th ps-th--right",children:"75th"}),e.jsx("th",{className:"ps-th ps-th--right",children:"90th"})]})}),e.jsx("tbody",{children:I.timeSteps.map((l,h)=>e.jsxs("tr",{className:"ps-tr",children:[e.jsx("td",{className:"ps-td ps-td--left",children:l.label}),e.jsx("td",{className:"ps-td ps-td--right",children:b(l.p10,s.code)}),e.jsx("td",{className:"ps-td ps-td--right",children:b(l.p25,s.code)}),e.jsx("td",{className:"ps-td ps-td--right ps-td--accent",children:b(l.median,s.code)}),e.jsx("td",{className:"ps-td ps-td--right",children:b(l.p75,s.code)}),e.jsx("td",{className:"ps-td ps-td--right",children:b(l.p90,s.code)})]},h))})]})})})]}),!I&&e.jsxs("div",{className:"ps-card ps-empty-card",children:[e.jsx("div",{className:"ps-empty-icon",children:"ðŸ“Š"}),e.jsx("h2",{className:"ps-empty-title",children:"No Simulation Yet"}),e.jsx("p",{className:"ps-empty-text",children:"Add some cash flows to see your Monte Carlo simulation."})]})]})]}),V&&e.jsx("div",{className:"confirm-overlay",onClick:we,children:e.jsxs("div",{className:"confirm-dialog",onClick:l=>l.stopPropagation(),children:[e.jsx("p",{className:"confirm-message",children:"You have unsaved changes"}),e.jsxs("div",{className:"confirm-actions",children:[e.jsx("button",{className:"confirm-btn confirm-btn--cancel",onClick:we,children:"Cancel"}),e.jsx("button",{className:"confirm-btn confirm-btn--discard",onClick:Ke,children:"Discard"}),e.jsx("button",{className:"confirm-btn confirm-btn--save",onClick:qe,children:"Save"})]})]})}),ee&&e.jsx(ns,{onClose:N,onSuccess:X})]})}export{aa as PortfolioSimulatorPage};
